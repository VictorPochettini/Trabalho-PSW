<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ArtBeat - Desafios</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
<!-- ArtBeat Bootstrap Customizations -->
<link href="css/bootstrap-artbeat.css" rel="stylesheet">
<link rel="stylesheet" href="css/pagInicialNew.css">
<link rel="stylesheet" href="css/desafios.css">
</head>
<body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(120deg, var(--artbeat-azul) 0%, #0d0b33 40%, #2e2573 100%);">
        <div class="container">
            <a class="navbar-brand" href="PagInicialNew.html" data-sound="navigation">
                <img src="images/ArtBeat_Branco.png" alt="ArtBeat" width="50" height="50" class="me-2">
                ArtBeat
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="PagInicialNew.html" data-sound="navigation">Início</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Artistas.html" data-sound="navigation">Artistas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="Desafios.html" data-sound="navigation">Desafios</a>
                    </li>
                </ul>
                <div class="d-flex">
                    <button class="btn btn-outline-primary me-2" onclick="window.location.href='CriacaoDeConta.html'">Cadastrar</button>
                    <button class="btn btn-primary" onclick="window.location.href='Login.html'">Entrar</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="desafios-container">
        <button class="nav-btn nav-left" onclick="prevChallenge()"><i class="fa-solid fa-chevron-left"></i></button>
        <button class="nav-btn nav-right" onclick="nextChallenge()"><i class="fa-solid fa-chevron-right"></i></button>

        <!-- Painel de desafio atual -->
        <div class="panel" id="currentChallenge">
            <h2 id="challengeTitle"></h2>
            <p id="challengeDesc"></p>
            <img id="challengeImg" class="challenge-img" src="" alt="Imagem do desafio">
        </div>

        <!-- Painel de resultado anterior -->
        <div class="panel" id="previousResult">
            <h2>Resultado do Desafio Anterior</h2>
            <div class="podium" id="podium">
                <div class="podium-item">
                    <i class="fa-solid fa-medal medal gold"></i>
                    <h3>Artista 1</h3>
                    <button>Ver post</button>
                </div>
                <div class="podium-item">
                    <i class="fa-solid fa-medal medal silver"></i>
                    <h3>Artista 2</h3>
                    <button>Ver post</button>
                </div>
                <div class="podium-item">
                    <i class="fa-solid fa-medal medal bronze"></i>
                    <h3>Artista 3</h3>
                    <button>Ver post</button>
                </div>
            </div>
        </div>
        
    </div>

    <!-- Custom User Challenges Section -->
    <div class="container mt-5">
        <h2 class="text-center mb-4" style="color: var(--artbeat-roxo);">Desafios da Comunidade</h2>
        <div class="row" id="customChallengesContainer">
            <!-- Challenge cards will be generated here -->
        </div>
    </div>

    <script>
        // Custom user challenges data
        const customChallenges = [
            {
                id: 1,
                creator: {
                    username: "@musicproducer",
                    avatar: "https://i.pravatar.cc/100?img=1"
                },
                title: "Batida Urbana 2024",
                type: "audio",
                timeLeft: "02:15:30", // HH:MM:SS
                participants: 23,
                submissions: [
                    {
                        id: 1,
                        user: {
                            username: "@beatmaker1",
                            avatar: "https://i.pravatar.cc/80?img=10"
                        },
                        audioUrl: "audios/audioPop.mpeg",
                        likes: 45,
                        liked: false
                    },
                    {
                        id: 2,
                        user: {
                            username: "@soundcreator",
                            avatar: "https://i.pravatar.cc/80?img=15"
                        },
                        audioUrl: "audios/audioPop.mpeg",
                        likes: 32,
                        liked: false
                    }
                ]
            },
            {
                id: 2,
                creator: {
                    username: "@artdirector",
                    avatar: "https://i.pravatar.cc/100?img=5"
                },
                title: "Arte Digital Cyberpunk",
                type: "image",
                timeLeft: "01:42:18",
                participants: 17,
                submissions: [
                    {
                        id: 3,
                        user: {
                            username: "@digitalartist",
                            avatar: "https://i.pravatar.cc/80?img=20"
                        },
                        imageUrl: "images/capa.png",
                        likes: 67,
                        liked: false
                    },
                    {
                        id: 4,
                        user: {
                            username: "@pixelmaster",
                            avatar: "https://i.pravatar.cc/80?img=25"
                        },
                        imageUrl: "images/capa.png",
                        likes: 42,
                        liked: false
                    }
                ]
            }
        ];

        // Function to create custom challenge cards
        function createCustomChallengeCards() {
            const container = document.getElementById('customChallengesContainer');
            container.innerHTML = '';

            customChallenges.forEach(challenge => {
                const challengeCard = document.createElement('div');
                challengeCard.className = 'col-md-6 mb-4';
                
                challengeCard.innerHTML = `
                    <div class="card h-100 shadow-sm" style="border: 2px solid var(--artbeat-roxo-claro);">
                        <!-- Challenge Header -->
                        <div class="card-header" style="background: linear-gradient(120deg, var(--artbeat-azul) 0%, var(--artbeat-roxo) 100%);">
                            <div class="d-flex justify-content-between align-items-center text-white">
                                <div class="d-flex align-items-center">
                                    <img src="${challenge.creator.avatar}" alt="Creator" class="rounded-circle me-2" width="40" height="40">
                                    <div>
                                        <h6 class="mb-0">${challenge.creator.username}</h6>
                                        <small class="opacity-75">Criador do desafio</small>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <div class="badge bg-warning text-dark px-3 py-2">
                                        <i class="fas fa-clock me-1"></i>
                                        <span id="timer-${challenge.id}">${challenge.timeLeft}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card-body">
                            <!-- Submit to Challenge Button -->
                            <div class="text-center mb-3">
                                <button class="btn btn-primary btn-lg" 
                                        id="submitBtn-${challenge.id}"
                                        style="background: linear-gradient(45deg, var(--artbeat-azul), var(--artbeat-roxo)); border: none; border-radius: 25px; padding: 10px 30px; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                                    <i class="fas fa-plus me-2"></i>
                                    Participar do Desafio
                                </button>
                            </div>
                            
                            <!-- Participants count -->
                            <div class="mb-3">
                                <span class="badge bg-info">
                                    <i class="fas fa-users me-1"></i>
                                    ${challenge.participants} participantes
                                </span>
                            </div>

                            <!-- Challenge Title -->
                            <h3 class="text-center mb-4" style="color: var(--artbeat-roxo); font-weight: bold;">
                                ${challenge.title}
                            </h3>

                            <!-- Submissions -->
                            <div class="submissions-container">
                                <h5 class="mb-3">Participações:</h5>
                                ${challenge.submissions.map(submission => 
                                    challenge.type === 'audio' ? 
                                    createAudioSubmission(submission, challenge.id) : 
                                    createImageSubmission(submission, challenge.id)
                                ).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(challengeCard);
            });

            // Start timers
            startChallengeTimers();
        }

        // Create audio submission HTML
        function createAudioSubmission(submission, challengeId) {
            return `
                <div class="submission-item mb-4 p-3" style="background-color: #f8f9fa; border-radius: 10px;">
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <img src="${submission.user.avatar}" alt="${submission.user.username}" 
                                 class="rounded-circle" width="60" height="60">
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-2">${submission.user.username}</h6>
                            <button class="btn btn-primary btn-sm play-btn mb-2"
                                    onclick="toggleAudio('audio-${submission.id}')" 
                                    id="playBtn-${submission.id}"
                                    style="width: 35px; height: 35px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                                <i class="fas fa-play" style="font-size: 14px;"></i>
                            </button>
                            <audio id="audio-${submission.id}" class="w-100" preload="metadata">
                                <source src="${submission.audioUrl}" type="audio/mpeg">
                            </audio>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="like-section">
                            <button class="custom-like-btn ${submission.liked ? 'liked' : ''}"
                                    onclick="toggleLike(${submission.id}, 'audio')"
                                    id="likeBtn-${submission.id}"
                                    data-sound="success"
                                    style="background: ${submission.liked ? '#dc3545' : 'none'}; border: 2px solid #dc3545; color: ${submission.liked ? 'white' : '#dc3545'}; padding: 5px 10px; border-radius: 20px; font-size: 14px; cursor: pointer; transition: all 0.3s ease;">
                                <i class="fas fa-heart me-1"></i>
                                <span id="likeCount-${submission.id}">${submission.likes}</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Create image submission HTML
        function createImageSubmission(submission, challengeId) {
            return `
                <div class="submission-item mb-4 p-3" style="background-color: #f8f9fa; border-radius: 10px;">
                    <div class="text-center">
                        <img src="${submission.imageUrl}" alt="Submission" 
                             class="img-fluid rounded mb-3" style="max-height: 300px;">
                        <h6 class="mb-3">${submission.user.username}</h6>
                        <div class="like-section">
                            <button class="custom-like-btn ${submission.liked ? 'liked' : ''}"
                                    onclick="toggleLike(${submission.id}, 'image')"
                                    id="likeBtn-${submission.id}"
                                    data-sound="success"
                                    style="background: ${submission.liked ? '#dc3545' : 'none'}; border: 2px solid #dc3545; color: ${submission.liked ? 'white' : '#dc3545'}; padding: 5px 10px; border-radius: 20px; font-size: 14px; cursor: pointer; transition: all 0.3s ease;">
                                <i class="fas fa-heart me-1"></i>
                                <span id="likeCount-${submission.id}">${submission.likes}</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Toggle audio play/pause
        function toggleAudio(audioId) {
            const audio = document.getElementById(audioId);
            const btn = document.getElementById('playBtn-' + audioId.split('-')[1]);
            const icon = btn.querySelector('i');
            
            if (audio.paused) {
                // Pause all other audio elements
                document.querySelectorAll('audio').forEach(a => {
                    if (a.id !== audioId) {
                        a.pause();
                        const otherId = a.id.split('-')[1];
                        const otherBtn = document.getElementById('playBtn-' + otherId);
                        if (otherBtn) {
                            otherBtn.querySelector('i').className = 'fas fa-play';
                        }
                    }
                });
                
                audio.play();
                icon.className = 'fas fa-pause';
            } else {
                audio.pause();
                icon.className = 'fas fa-play';
            }

            // Reset button when audio ends
            audio.onended = () => {
                icon.className = 'fas fa-play';
            };
        }

        // Toggle like functionality
        function toggleLike(submissionId, type) {
            console.log('toggleLike called for submission:', submissionId, 'type:', type);
            const likeBtn = document.getElementById('likeBtn-' + submissionId);
            const likeCount = document.getElementById('likeCount-' + submissionId);
            
            if (!likeBtn || !likeCount) {
                console.error('Like button or count element not found');
                return;
            }
            
            // Find the submission in the data
            let submission = null;
            customChallenges.forEach(challenge => {
                const found = challenge.submissions.find(s => s.id === submissionId);
                if (found) submission = found;
            });

            if (submission) {
                if (!submission.liked) {
                    // Liking the submission
                    console.log('Liking submission...');
                    submission.likes++;
                    submission.liked = true;
                    likeBtn.style.background = '#dc3545';
                    likeBtn.style.color = 'white';
                    likeBtn.classList.add('liked');
                    
                    // Play like sound
                    console.log('Playing success sound...');
                    if (typeof window.ArtBeatSounds !== 'undefined') {
                        window.ArtBeatSounds.play('success');
                        console.log('Success sound should have played');
                    } else {
                        console.error('ArtBeatSounds not available');
                    }
                } else {
                    // Unliking the submission
                    console.log('Unliking submission...');
                    submission.likes--;
                    submission.liked = false;
                    likeBtn.style.background = 'none';
                    likeBtn.style.color = '#dc3545';
                    likeBtn.classList.remove('liked');
                    
                    // Play unlike sound
                    console.log('Playing click sound...');
                    if (typeof window.ArtBeatSounds !== 'undefined') {
                        window.ArtBeatSounds.play('click');
                        console.log('Click sound should have played');
                    } else {
                        console.error('ArtBeatSounds not available');
                    }
                }
                
                likeCount.textContent = submission.likes;
            } else {
                console.error('Submission not found');
            }
        }

        // Timer functionality
        function startChallengeTimers() {
            customChallenges.forEach(challenge => {
                const timer = document.getElementById('timer-' + challenge.id);
                if (timer) {
                    updateTimer(timer, challenge.timeLeft, challenge.id);
                }
            });
        }

        function updateTimer(element, timeString, challengeId) {
            let [hours, minutes, seconds] = timeString.split(':').map(Number);
            
            const interval = setInterval(() => {
                if (seconds > 0) {
                    seconds--;
                } else if (minutes > 0) {
                    minutes--;
                    seconds = 59;
                } else if (hours > 0) {
                    hours--;
                    minutes = 59;
                    seconds = 59;
                } else {
                    clearInterval(interval);
                    element.textContent = "ENCERRADO";
                    element.parentElement.classList.remove('bg-warning');
                    element.parentElement.classList.add('bg-danger');
                    return;
                }
                
                element.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // Initialize custom challenges when page loads
        document.addEventListener('DOMContentLoaded', () => {
            createCustomChallengeCards();
        });

        // Original challenge navigation code
        const challenges = [
            {
                title: "Desafio da Semana: A vida é uma maravilha",
                desc: "Crie uma obra que traga esse sentimento à tona.",
                img: "https://imgs.search.brave.com/JIZ1UG3nLySZXXwRcHFuK8aBkiqMkGdz7NewDB1RLTI/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9tZWRp/YS5nZXR0eWltYWdl/cy5jb20vaWQvMTQ1/MDI2ODU1OC9waG90/by9zdW1tZXItc2Vs/ZmllLmpwZz9zPTYx/Mng2MTImdz0wJms9/MjAmYz1JaXZHUUlY/VjdwQ3VfdHIxMEkw/a2FEb3VVdElpX3BL/ek9ycUJfTkFHb0NB/PQ",
                results: [
                    {name:"Luna Beats", img:"https://i.pravatar.cc/300?img=12"},
                    {name:"Rafa Groove", img:"https://i.pravatar.cc/300?img=32"},
                    {name:"Clara Voz", img:"https://i.pravatar.cc/300?img=45"}
                ]
            },
            {
                title: "Desafio do Mês: Velho Oeste",
                desc: "Crie uma obra que remeta a esse tempo distante e imprevisível.",
                img: "https://imgs.search.brave.com/WFXTTes_LFKGfrjHHcTxe8PqR6Y8j1LTWh4oH5xVYOg/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly93YWxs/cGFwZXJzLmNvbS9p/bWFnZXMvaGQvd2ls/ZC13ZXN0LWJhY2tn/cm91bmQtZTBnbzAw/Ymowa2NsMzNzcS5q/cGc",
                results: [
                    {name:"João Letras", img:"https://i.pravatar.cc/300?img=22"},
                    {name:"Ana Poesia", img:"https://i.pravatar.cc/300?img=41"},
                    {name:"Carlos Conto", img:"https://i.pravatar.cc/300?img=14"}
                ]
            }
        ];

        let currentIndex = 0;

        function updateChallenge() {
            const challenge = challenges[currentIndex];
            const panelCurrent = document.getElementById("currentChallenge");
            const panelResult = document.getElementById("previousResult");

            // fade out
            panelCurrent.classList.add("fade-out");
            panelResult.classList.add("fade-out");

            setTimeout(() => {
                document.getElementById("challengeTitle").innerText = challenge.title;
                document.getElementById("challengeDesc").innerText = challenge.desc;
                document.getElementById("challengeImg").src = challenge.img;

                const podium = document.getElementById("podium");
                podium.innerHTML = "";
                const medals = ["gold", "silver", "bronze"];
                challenge.results.forEach((winner, i) => {
                    const div = document.createElement("div");
                    div.className = "podium-item";
                    div.innerHTML = `
                        <i class="fa-solid fa-medal medal ${medals[i]}"></i>
                        <h3>${winner.name}</h3>
                        <button>Ver post</button>
                    `;
                    podium.appendChild(div);
                });

                // fade in
                panelCurrent.classList.remove("fade-out");
                panelResult.classList.remove("fade-out");
            }, 300);
        }

        function nextChallenge() {
            currentIndex = (currentIndex + 1) % challenges.length;
            updateChallenge();
        }

        function prevChallenge() {
            currentIndex = (currentIndex - 1 + challenges.length) % challenges.length;
            updateChallenge();
        }

        // Inicializa
        updateChallenge();
    </script>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>ArtBeat</h3>
                    <p>Conectando artistas independentes e amantes da música em uma plataforma colaborativa e inovadora.</p>
                </div>
                <div class="footer-column">
                    <h3>Links Rápidos</h3>
                    <ul>
                        <li><a href="PagInicialNew.html">Início</a></li>
                        <li><a href="Artistas.html">Artistas</a></li>
                        <li><a href="Desafios.html">Desafios</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Recursos</h3>
                    <ul>
                        <li><a href="#">Como funciona</a></li>
                        <li><a href="#">Para artistas</a></li>
                        <li><a href="#">Para ouvintes</a></li>
                        <li><a href="#">Blog</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

    <!-- ArtBeat Sound System -->
    <script src="js/artbeat-sounds.js"></script>
    </body>
</html>
